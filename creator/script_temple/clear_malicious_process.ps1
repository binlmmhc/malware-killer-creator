#kill process by process name
$kill_process_by_name = $true
$malicious_process_names = ( 
    "notepad"
)
if($kill_process_by_name){ 
    Try{ 
        ForEach($malicious_process_name in $malicious_process_names){ 
            $process  = Get-Process -Name $malicious_process_name -ErrorAction SilentlyContinue
            if($process){ 
                if($process.count -gt 1){ 
                    ForEach($ps in $process){ 
                        $ps.Kill()
                        $namepid = $ps.Name + " " + $ps.Id
                        
                        Write-Host "[+] Kill malicious process $namepid  successfully." -ForegroundColor Green -BackgroundColor Black
                    }
                }
                else{ 
                    $process.Kill()
                    $namepid = $malicious_process_name + " " + $process.Id
                    Write-Host "[+] Kill malicious process $namepid successfully." -ForegroundColor Green -BackgroundColor Black
                }
            }
        }
    }
    Catch{ 
        Write-Host "[-] Some thing wrong while kill process by name." -ForegroundColor Red -BackgroundColor Balck
    }
}

#kill process by execute file hash
$kill_process_by_file_hash = $true
$malicious_process_filehashs = ( 
    "899346F9F283A4FD5AA03015A3F58CDE5B9C0B6A5C4D64C2CC74E9B22C1348D7"
)
if($kill_process_by_file_hash){ 
    Try{ 
        $process_all  = Get-Process
        ForEach($process in $process_all){ 
            ForEach($malicious_process_filehash in $malicious_process_filehashs){ 
                $process_path = $process.Path
                if($process_path){ 
                    if(hash_and_compare -file_path $process_path -compare_hash $malicious_process_filehash){ 
                        $namepid = $process.Name + " " + $process.Id
                        $process.Kill()
                        Write-Host "[+] Kill malicious process $namepid successfully." -ForegroundColor Green -BackgroundColor Black
                    }
                }
            }
        }
    }
    Catch{ 
        Write-Host "[-] Some thing wrong while kill process." -ForegroundColor Red -BackgroundColor Black
    }
}

#kill process by process's commandline
$kill_process_by_commandline = $True
$malicious_process_commandlines = (
    "powershell.exe*hidden*enc",
    "powershell.exe*NoP*NonI*Hidden"
)
if($kill_process_by_commandline){ 
    Try{ 
        $processes = Get-WmiObject -Class Win32_Process
        ForEach($process in $processes){ 
            $commandline = $process.CommandLine
            if($commandline){ 
                $commandline = $process.CommandLine.Tolower()

                ForEach($malicious_process_commandline in $malicious_process_commandlines){
                    $lower_malicious_commandline = $malicious_process_commandline.Tolower()
                    $match = $commandline -like "*$lower_malicious_commandline*"
                    if($match){ 
                        Write-Host "[*] Found malicious process " $process.Name  " with pid " $process.ProcessID -ForegroundColor Green -BackgroundColor black
                        Stop-Process  -Id $process.ProcessID -Force -Confirm:$False
                        Write-Host "[+] kill malicious process " $process.Name " with pid " $process.ProcessID " successfully." -ForegroundColor Green -BackgroundColor black
                        break
                    }
                }
            }
        }
    }
    Catch{ 
        Write-Host "[-] Some thing wrong while killing process by commandline."
    }
}