
#delete service by service name, and service name is not displayname
if($delete_service_by_service_name){ 
    Try{ 
        ForEach($malicious_service_name in $malicious_service_names){ 
            $find_service = Get-Service -Name $malicious_service_name -ErrorAction SilentlyContinue
            if($find_service){ 
                if($find_service.Status -eq "Running"){ 
                   if($find_service.CanStop){ 
                       $find_service.Stop()
                   }
                }
                $find_service.Dispose()
                sc.exe delete $malicious_service_names | Out-Null
            }
        }
    }
    Catch{ 
        Write-Host "[-] Some thing wrong while delete service by service name." -BackgroundColor Black -ForegroundColor Red
    }
}

#delete service by service execute file sha256 hash
if($delete_service_by_execute_file_hash){ 
    Try{ 
        $services = Get-WmiObject -Class Win32_Service
        ForEach($service in $services ){ 
            $service_name = $service.Name        
            $service_execute_path = $service.PathName

            #$service_name + " " + $service_execute_path | Out-Host
            if($service_execute_path -like '"*"'){
                $service_execute_path = $service_execute_path.Replace('"', "")
            }

            if($service_execute_path -like "%*%*"){ 
                $service_execute_path = [System.Environment]::ExpandEnvironmentVariables($service_execute_path)
            }

            if($service_execute_path){ 
                ForEach($malicious_service_file_hash in $malicious_service_file_hashs){ 
                    if(hash_and_compare -file_path $service_execute_path -compare_hash $malicious_service_file_hash){ 
                        if($service.State -eq "Running"){ 
                            $service.StopService() | Out-Null
                        }
                        $service.delete() | Out-Null

                        if(Test-Path -Path $service_execute_path){ 
                            Remove-Item -Path $service_execute_path -Confirm:$False -ErrorAction SilentlyContinue
                        }
                    }
                }
                
            }
        }
    }
    Catch{ 
        Write-Host "[-] Some thing wrong while delete service by service execute file hash." -BackgroundColor Black -ForegroundColor Red
    }
}
