#**************************************************Common Functons For All**************************************************
$sha256 = New-Object System.Security.Cryptography.SHA256Managed
Function hash_and_compare($file_path, $compare_hash){ 
    Try{ 
        if(Test-Path -Path "$file_path" -ErrorAction SilentlyContinue){ 
            $hashdata = [System.IO.File]::Open($file_path, "open", "read")
        }

        if($hashdata){ 
            $calchash = ""
            ForEach($i in $sha256.ComputeHash($hashdata) | ForEach-Object {$_.ToString("x2")}){
                $calchash += $i 
            }
            $file_path + " " + $calchash | Out-Host

            $hashdata.dispose()
            
            if($calchash.ToUpper() -eq $compare_hash.ToUpper()){ 
                return $TRUE
            }
        }        
    }
    Catch{ 
        Write-Host "[-]Something Wrong while sha256 hash Matching." -BackgroundColor Black -ForegroundColor Red
        return $FALSE
    }
}
#**************************************************Common Functons End Line**************************************************

$kill_process_by_file_hash = $true
$malicious_process_filehashs = ( 
    "899346F9F283A4FD5AA03015A3F58CDE5B9C0B6A5C4D64C2CC74E9B22C1348D7"
)

if($kill_process_by_file_hash){ 
    Try{ 
        $process_all  = Get-Process
        ForEach($process in $process_all){ 
            ForEach($malicious_process_filehash in $malicious_process_filehashs){ 
                $process_path = $process.Path
                if($process_path){ 
                    if(hash_and_compare -file_path $process_path -compare_hash $malicious_process_filehash){ 
                        $namepid = $process.Name + " " + $process.Id
                        $process.Kill()
                        Write-Host "[+] Kill malicious process $namepid successfully." -ForegroundColor Green -BackgroundColor Black
                    }
                }
            }
        }
    }
    Catch{ 
        Write-Host "[-] Some thing wrong while kill process." -ForegroundColor Red -BackgroundColor Black
    }
}
